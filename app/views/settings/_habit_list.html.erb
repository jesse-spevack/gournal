<%# Bullet journal style habit list %>
<div data-controller="context-menu" 
     data-target-year="<%= @target_year || Date.current.year %>" 
     data-target-month="<%= @target_month || Date.current.month %>">
  <ul class="habit-list">
    <% @habits.each do |habit| %>
      <li class="habit-item" 
          data-habit-id="<%= habit.id %>"
          data-habit-name="<%= habit.name %>"
          data-context-menu-target="habitItem">
        <span class="bullet">•</span>
        <span class="habit-name">
          <%= habit.name %>
        </span>
      </li>
    <% end %>
  </ul>
  
  <%# New habit form %>
  <div class="habit-item habit-item--new">
    <span class="bullet">•</span>
    <%= form_with url: habits_path, 
                  method: :post,
                  data: { 
                    inline_habit_editor_target: "newForm",
                    action: "submit->inline-habit-editor#createHabit"
                  },
                  class: "new-habit-form" do |form| %>
      <% if defined?(@year_month) && @year_month.present? %>
        <%= form.hidden_field :year_month, value: @year_month %>
      <% end %>
      <%= form.text_field :name, 
                          placeholder: "Add new habit", 
                          class: "habit-input habit-input--new",
                          autocomplete: "off",
                          data: { 
                            inline_habit_editor_target: "newInput",
                            action: "blur->inline-habit-editor#createHabit keydown.esc->inline-habit-editor#cancelNew"
                          } %>
    <% end %>
  </div>
  
  <%# Onboarding hint for new users %>
  <% if @user&.not_started? %>
    <%= render 'onboarding_hint', hint_text: 'Start by adding your first habit above.' %>
  <% end %>
  
  <%# Context menu structure %>
  <div class="context-menu-backdrop" 
       data-context-menu-target="backdrop" 
       data-action="click->context-menu#hideMenu"></div>
  
  <div class="context-menu" 
       data-context-menu-target="menu"
       role="menu"
       aria-label="Habit actions">
    <%= render 'shared/context_button', 
        text: 'Edit name', 
        data: { action: "click->context-menu#editName" },
        role: "menuitem",
        tabindex: "-1" %>
    <%= render 'shared/context_button', 
        text: 'Move up', 
        data: { action: "click->context-menu#moveUp" },
        role: "menuitem",
        tabindex: "-1" %>
    <%= render 'shared/context_button', 
        text: 'Move down', 
        data: { action: "click->context-menu#moveDown" },
        role: "menuitem",
        tabindex: "-1" %>
    <%= render 'shared/context_button', 
        text: 'Delete habit', 
        danger: true,
        data: { action: "click->context-menu#deleteHabit" },
        role: "menuitem",
        tabindex: "-1" %>
    <%= render 'shared/context_button', 
        text: 'Cancel', 
        cancel: true,
        data: { action: "click->context-menu#hideMenu" },
        role: "menuitem",
        tabindex: "-1" %>
  </div>
</div>