<%# Bullet journal style habit list %>
<div data-controller="inline-habit-editor context-menu" 
     data-target-year="<%= @target_year || Date.current.year %>" 
     data-target-month="<%= @target_month || Date.current.month %>">
  <ul class="habit-list">
    <% @habits.each do |habit| %>
      <li class="habit-item" 
          data-habit-id="<%= habit.id %>"
          data-habit-name="<%= habit.name %>"
          data-context-menu-target="habitItem">
        <span class="bullet">•</span>
        <span class="habit-name">
          <%= habit.name %>
        </span>
      </li>
    <% end %>
  </ul>
  
  <%# New habit form %>
  <div class="habit-item habit-item--new">
    <span class="bullet">•</span>
    <%= form_with url: habits_path, 
                  method: :post,
                  data: { 
                    inline_habit_editor_target: "newForm",
                    action: "submit->inline-habit-editor#createHabit"
                  },
                  class: "new-habit-form" do |form| %>
      <% if defined?(@year_month) && @year_month.present? %>
        <%= form.hidden_field :year_month, value: @year_month %>
      <% end %>
      <%= form.text_field :name, 
                          placeholder: "Add new habit", 
                          class: "habit-input habit-input--new",
                          data: { 
                            inline_habit_editor_target: "newInput",
                            action: "blur->inline-habit-editor#createHabit keydown.esc->inline-habit-editor#cancelNew"
                          } %>
    <% end %>
  </div>
  
  <%# Context menu structure %>
  <div class="context-menu-backdrop" 
       data-context-menu-target="backdrop" 
       data-action="click->context-menu#hideMenu"
       style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3); z-index: 998;"></div>
  
  <div class="context-menu" 
       data-context-menu-target="menu"
       style="display: none; position: fixed; background: white; border: 1px solid #ccc; border-radius: 8px; padding: 8px 0; z-index: 999; min-width: 200px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div class="context-menu__item" data-action="click->context-menu#editName" style="padding: 12px 20px; cursor: pointer; hover: background: #f5f5f5;">
      Edit name
    </div>
    <div class="context-menu__item" data-action="click->context-menu#moveUp" style="padding: 12px 20px; cursor: pointer;">
      Move up
    </div>
    <div class="context-menu__item" data-action="click->context-menu#moveDown" style="padding: 12px 20px; cursor: pointer;">
      Move down
    </div>
    <div class="context-menu__item context-menu__item--danger" data-action="click->context-menu#deleteHabit" style="padding: 12px 20px; cursor: pointer; color: #dc3545;">
      Delete habit
    </div>
    <div class="context-menu__item context-menu__item--cancel" data-action="click->context-menu#hideMenu" style="padding: 12px 20px; cursor: pointer; border-top: 1px solid #eee; margin-top: 8px; padding-top: 20px;">
      Cancel
    </div>
  </div>
</div>