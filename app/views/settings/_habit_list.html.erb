<%# Bullet journal style habit list %>
<div data-controller="context-menu" 
     data-target-year="<%= @target_year || Date.current.year %>" 
     data-target-month="<%= @target_month || Date.current.month %>">
  <ul class="habit-list">
    <% @habits.each do |habit| %>
      <li class="habit-item" 
          data-habit-id="<%= habit.id %>"
          data-habit-name="<%= habit.name %>"
          data-context-menu-target="habitItem">
        <span class="bullet">•</span>
        <span class="habit-name">
          <%= habit.name %>
        </span>
      </li>
    <% end %>
  </ul>
  
  <%# New habit form %>
  <div class="habit-item habit-item--new">
    <span class="bullet">•</span>
    <%= form_with url: habits_path, 
                  method: :post,
                  data: { 
                    inline_habit_editor_target: "newForm",
                    action: "submit->inline-habit-editor#createHabit"
                  },
                  class: "new-habit-form" do |form| %>
      <% if defined?(@year_month) && @year_month.present? %>
        <%= form.hidden_field :year_month, value: @year_month %>
      <% end %>
      <%= form.text_field :name, 
                          placeholder: "Add new habit", 
                          class: "habit-input habit-input--new",
                          data: { 
                            inline_habit_editor_target: "newInput",
                            action: "blur->inline-habit-editor#createHabit keydown.esc->inline-habit-editor#cancelNew"
                          } %>
    <% end %>
  </div>
  
  <%# Context menu structure %>
  <div class="context-menu-backdrop" 
       data-context-menu-target="backdrop" 
       data-action="click->context-menu#hideMenu"></div>
  
  <div class="context-menu" 
       data-context-menu-target="menu"
       role="menu"
       aria-label="Habit actions">
    <button class="context-menu__item" 
            data-action="click->context-menu#editName"
            role="menuitem" 
            tabindex="-1">
      Edit name
    </button>
    <button class="context-menu__item" 
            data-action="click->context-menu#moveUp"
            role="menuitem" 
            tabindex="-1">
      Move up
    </button>
    <button class="context-menu__item" 
            data-action="click->context-menu#moveDown"
            role="menuitem" 
            tabindex="-1">
      Move down
    </button>
    <button class="context-menu__item context-menu__item--danger" 
            data-action="click->context-menu#deleteHabit"
            role="menuitem" 
            tabindex="-1">
      Delete habit
    </button>
    <button class="context-menu__item context-menu__item--cancel" 
            data-action="click->context-menu#hideMenu"
            role="menuitem" 
            tabindex="-1">
      Cancel
    </button>
  </div>
</div>