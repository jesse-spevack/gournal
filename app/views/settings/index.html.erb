<%# Settings Page with Three Main Sections %>
<div class="paper-background">
  <div class="container">
    <div class="dot-grid-overlay">
      
      <%# Back button in top-right - only show if user has habits %>
      <% if @habits.any? %>
        <div class="settings-link-container">
          <%= render 'shared/navigation_button', text: '<', url: root_path, class: 'settings-link' %>
        </div>
      <% end %>
      
      <%# Header - using same class as habit tracker %>
      <header class="month-header">
        <h1>Settings</h1>
      </header>
      
      <%# Main Settings Content %>
      <div class="settings-content" data-onboarding-state="<%= @onboarding_state %>">
        
        <%# Section 1: Manage Habits - Always visible %>
        <section class="settings-section habits-management">
          <div class="section-header">
            <h2 class="settings-section-title">Manage habits</h2>
            <%= render 'shared/navigation_button', text: '(?)', variant: 'help', url: help_manage_habits_path %>
          </div>
          <div class="section-content">
            <%= render "habit_list", habits: @habits %>
          </div>
        </section>
        
        <%# Section 2: Profile Link - Show based on onboarding state %>
        <% if @user.show_profile_section? %>
          <section class="settings-section profile-url">
            <div class="section-header">
              <h2 class="settings-section-title">Profile link</h2>
              <%= render 'shared/navigation_button', text: '(?)', variant: 'help', url: help_profile_link_path %>
            </div>
            <div class="section-content">
              <%= render "profile_url_section", user: @user %>
            </div>
          </section>
        <% end %>
        
        <%# Section 3: Privacy Settings - Show based on onboarding state %>
        <% if @user.show_sharing_section? %>
          <section class="settings-section privacy-settings">
            <div class="section-header">
              <h2 class="settings-section-title">Sharing</h2>
              <%= render 'shared/navigation_button', text: '(?)', variant: 'help', url: help_sharing_settings_path %>
            </div>
            <div class="section-content">
              <%= render "privacy_settings_section", user: @user %>
            </div>
          </section>
        <% end %>
        
        <%# Section 4: Month Setup - only show if user has habits AND onboarding is complete %>
        <% if @habits.any? && @user.onboarding_finished? %>
          <section class="settings-section month-setup">
            <%= render "month_setup_section" %>
          </section>
        <% end %>
        
        <%# Skip onboarding option for users in onboarding flow %>
        <% if @user.in_onboarding? %>
          <div class="skip-onboarding-section">
            <%= link_to "Skip setup", onboarding_path, 
                class: "skip-onboarding-link",
                data: { 
                  method: :delete,
                  confirm: "Skip the guided setup? You can still access all features normally."
                } %>
          </div>
        <% end %>
        
      </div>
      
    </div>
  </div>
</div>