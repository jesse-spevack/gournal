<%# Month setup section - show setup form or view next month link %>
<%
  target_year = @next_month_date.year
  target_month = @next_month_date.month
  month_name = format_month_name(@next_month_date)
%>

<% if @next_month_habits_exist %>
  <%# Show view next month link when habits already exist %>
  <div class="section-header">
    <%= render 'shared/secondary_button', text: "View #{month_name} â†—", url: habit_entries_path(year: target_year, month: target_month), class: "settings-section-title month-view-heading" %>
  </div>
<% else %>
  <%# Show header and setup form when no habits exist %>
  <div class="section-header">
    <h2 class="settings-section-title">Set up next month</h2>
    <%= render 'shared/navigation_button', text: '(?)', variant: 'help', url: help_next_month_setup_path %>
  </div>
  <div class="section-content">
  <%# Show month setup form when no habits exist %>
  <%
    x_marks = JSON.parse(random_x_marks_json)
  %>

  <div data-controller="month-setup" 
       data-month-setup-x-marks-value="<%= random_x_marks_json %>"
       data-month-setup-target-year-value="<%= target_year %>"
       data-month-setup-target-month-value="<%= target_month %>"
       data-month-setup-default-option-value="copy"
       data-month-setup-fallback-option-value="fresh">
    
    <%= form_with url: month_setups_path, 
                  method: :post,
                  data: { 
                    month_setup_target: "form",
                    action: "submit->month-setup#handleSubmit"
                  },
                  class: "month-setup-form" do |form| %>
      
      <%= form.hidden_field :target_year, value: target_year %>
      <%= form.hidden_field :target_month, value: target_month %>
      <%= form.hidden_field :strategy, value: "", data: { month_setup_target: "strategyField" } %>
      
      <div class="month-setup-options">
        
        <div class="month-setup-option" 
             data-month-setup-target="option"
             data-option-value="copy">
          <div class="checkbox-label-container"
               data-action="click->month-setup#selectOption"
               data-option="copy">
            <div class="checkbox-container">
              <%= render "checkboxes/box_0" %>
              <% x_marks.each do |variant| %>
                <div class="checkbox-x-wrapper" data-x-variant="<%= variant %>" style="display: none;">
                  <%= render "checkboxes/x_#{variant}" %>
                </div>
              <% end %>
            </div>
            <label class="month-setup-label">
              Copy current habits
            </label>
          </div>
        </div>
        
        <div class="month-setup-option"
             data-month-setup-target="option"
             data-option-value="fresh">
          <div class="checkbox-label-container"
               data-action="click->month-setup#selectOption"
               data-option="fresh">
            <div class="checkbox-container">
              <%= render "checkboxes/box_0" %>
              <% x_marks.each do |variant| %>
                <div class="checkbox-x-wrapper" data-x-variant="<%= variant %>" style="display: none;">
                  <%= render "checkboxes/x_#{variant}" %>
                </div>
              <% end %>
            </div>
            <label class="month-setup-label">
              Start fresh
            </label>
          </div>
        </div>
        
      </div>
      
      <%= render 'shared/primary_button', 
          text: "Set up #{month_name}", 
          type: 'submit',
          disabled: true,
          data: { month_setup_target: "submitButton" } %>
      
    <% end %>
    
  </div>
  </div>
<% end %>