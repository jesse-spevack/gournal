<%# Month setup section with exclusive checkboxes %>
<%
  next_month_date = Date.current.next_month
  target_year = next_month_date.year
  target_month = next_month_date.month
  month_name = format_month_name(next_month_date)
  x_marks = JSON.parse(random_x_marks_json)
%>

<div data-controller="month-setup" 
     data-month-setup-x-marks-value="<%= random_x_marks_json %>"
     data-month-setup-target-year-value="<%= target_year %>"
     data-month-setup-target-month-value="<%= target_month %>"
     data-month-setup-default-option-value="copy"
     data-month-setup-fallback-option-value="fresh">
  
  <%= form_with url: month_setups_path, 
                method: :post,
                data: { 
                  month_setup_target: "form",
                  action: "submit->month-setup#handleSubmit"
                },
                class: "month-setup-form" do |form| %>
    
    <%= form.hidden_field :target_year, value: target_year %>
    <%= form.hidden_field :target_month, value: target_month %>
    <%= form.hidden_field :strategy, value: "", data: { month_setup_target: "strategyField" } %>
    
    <div class="month-setup-options">
      
      <div class="month-setup-option" 
           data-month-setup-target="option"
           data-option-value="copy">
        <div class="checkbox-label-container"
             data-action="click->month-setup#selectOption"
             data-option="copy">
          <div class="checkbox-container">
            <%= render "checkboxes/box_0" %>
            <% x_marks.each do |variant| %>
              <div class="checkbox-x-wrapper" data-x-variant="<%= variant %>" style="display: none;">
                <%= render "checkboxes/x_#{variant}" %>
              </div>
            <% end %>
          </div>
          <label class="month-setup-label">
            Copy current habits
          </label>
        </div>
      </div>
      
      <div class="month-setup-option"
           data-month-setup-target="option"
           data-option-value="fresh">
        <div class="checkbox-label-container"
             data-action="click->month-setup#selectOption"
             data-option="fresh">
          <div class="checkbox-container">
            <%= render "checkboxes/box_0" %>
            <% x_marks.each do |variant| %>
              <div class="checkbox-x-wrapper" data-x-variant="<%= variant %>" style="display: none;">
                <%= render "checkboxes/x_#{variant}" %>
              </div>
            <% end %>
          </div>
          <label class="month-setup-label">
            Start fresh
          </label>
        </div>
      </div>
      
    </div>
    
    <button type="submit" 
            class="month-setup-submit"
            data-month-setup-target="submitButton"
            disabled>
      Set up <%= month_name %>
    </button>
    
  <% end %>
  
</div>