<%# Profile URL editing form %>
<%
  x_marks = JSON.parse(random_x_marks_json)
%>

<div data-controller="privacy-settings" 
     data-privacy-settings-x-marks-value="<%= random_x_marks_json %>">
  
  <%= form_with model: user, 
                url: settings_path,
                method: :patch,
                data: { 
                  privacy_settings_target: "form"
                },
                class: "month-setup-form" do |form| %>
    
    <%# Profile URL display with inline editing %>
    <div class="profile-url-section">
      <div class="profile-url-display"
           data-privacy-settings-target="urlDisplay"
           data-action="click->privacy-settings#copyUrl">
        <span class="profile-url-prefix">verynormal.dev/</span>
        <span class="profile-slug-editable" 
              data-privacy-settings-target="slugDisplay"
              data-action="click->privacy-settings#editSlug"
              <%= user.slug.blank? ? 'data-placeholder="true"' : '' %>>
          <%= user.slug.present? ? user.slug : "your-custom-share-link" %>
        </span>
      </div>
      <%= form.hidden_field :slug, 
                           value: user.slug || "",
                           data: { privacy_settings_target: "slugField" } %>
      <% if user.errors[:slug].any? %>
        <div class="field-error">
          <%= user.errors[:slug].first %>
        </div>
      <% end %>
    </div>
    
    <%# Onboarding hint for users who just created habits %>
    <% if user.habits_created? %>
      <%= render 'onboarding_hint', hint_text: 'Click on "your-custom-share-link" above to create your profile link.' %>
    <% end %>
    
    <%# Submit button %>
    <%= render 'shared/primary_button', 
        text: 'Save profile link', 
        type: 'submit',
        data: { privacy_settings_target: "submitButton" } %>
    
  <% end %>
  
</div>