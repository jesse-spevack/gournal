<%# Japanese Paper Background with Container %>
<div class="paper-background">
  <div class="container">
    <div class="dot-grid-overlay">
      
      <%# Header - Simple "September 2025" for Phase 2 %>
      <header class="month-header">
        <h1><%= @tracker_data.month_name %> <%= @tracker_data.year %></h1>
      </header>
      
      <%# Grid Layout: Day numbers + Habit columns + Reflection column %>
      <div class="habit-grid" data-csrf-token="<%= form_authenticity_token %>">
        
        <%# Column Headers %>
        <div class="grid-headers">
          <div class="day-column-header"></div>
          <% @tracker_data.habits.each do |habit| %>
            <div class="habit-column-header">
              <span class="habit-name"><%= habit.name %></span>
            </div>
          <% end %>
          <div class="reflection-column-header">
            <span class="reflection-label">Reflection</span>
          </div>
        </div>
        
        <%# Grid Rows: One row per day %>
        <div class="grid-rows">
          <% @tracker_data.days.each do |day| %>
            <div class="day-row" data-day="<%= day %>">
              
              <%# Day Number %>
              <div class="day-number"><%= day %></div>
              
              <%# Habit Checkboxes %>
              <% @tracker_data.habits.each do |habit| %>
                <div class="habit-checkbox">
                  <% entry = @tracker_data.habit_entry_for(habit.id, day) %>
                  <% if entry %>
                    <%= render_habit_checkbox(entry) %>
                  <% end %>
                </div>
              <% end %>
              
              <%# Reflection Column %>
              <div class="reflection-cell">
                <% reflection = @tracker_data.reflection_for(day) %>
                <% reflection_date = Date.new(@tracker_data.year, @tracker_data.month, day) %>
                <textarea 
                  class="reflection-textarea"
                  data-controller="reflection-editor"
                  data-reflection-editor-id-value="<%= reflection&.id %>"
                  data-reflection-editor-date-value="<%= reflection_date.iso8601 %>"
                  data-reflection-editor-user-id-value="<%= @tracker_data.user&.id %>"
                  rows="1"
                  data-action="input->reflection-editor#autoResize focus->reflection-editor#onFocus blur->reflection-editor#onBlur"
                  aria-label="Daily reflection for <%= reflection_date.strftime('%B %d, %Y') %>"
                  role="textbox"
                  tabindex="0"><%= reflection&.content %></textarea>
              </div>
              
            </div>
          <% end %>
        </div>
        
      </div>
      
    </div>
  </div>
</div>